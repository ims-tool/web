<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"	>
		
	 <h:head>
	    <meta content='text/html; charset=UTF-8' http-equiv="Content-Type"/>
	</h:head>
	
	<ui:composition template="/pages/template/mainTemplate.xhtml">
		<ui:define name="conteudo">
	
				
			<script type="text/javascript">
			    function handleDrop(event, ui) {
			        var droppedFormType = ui.draggable;			 
			        droppedFormType.fadeOut('fast');
			    }
			</script>
			
			
			<h:form id="form">
			    <p:growl id="msgs" showDetail="true" />
			    <p:layout closeTitle="Cadastrar" resizeTitle="Cadastrar" collapseTitle="Cadastrar" expandTitle="Cadastrar"  id="layoutFlowEditor" style="min-width:600px;min-height:600px;" >
    				<p:layoutUnit position="west" resizable="false" size="80">
    				
	    				<p:dataTable id="palleteData" var="formType" value="#{flowEditorView.formTypes}" >
				            <p:column headerText="Pallete">
				            	<p:graphicImage id="pallete" url="#{formType.imagePath}" width="60px" height="60px" alt="formType.description" />
				                <p:draggable for="pallete" revert="true" helper="clone" />
				            </p:column>
				       </p:dataTable>
    				
					</p:layoutUnit>
			    
				    <p:layoutUnit position="center" resizable="true">
				 
						    <p:diagram widgetVar="graph" 
						               value="#{flowEditorView.model}" 
						               style="height:100%" styleClass="ui-widget-content" 
						               var="el" id="flowEditor" converter="elementConverter" >
						        
 
							        <f:facet  name="element"  >
							             <p:panel id="panelNode">
								            <h:outputText value="#{el.name}" style="display:block;margin-top:1em;" />
								            <p:graphicImage url="#{el.formType.imagePath}" width="60px" height="60px" alt="#{el.name}" />
								            <p:commandButton value="Settings" style="display:block;margin-botton:1em;"  action="#{flowEditorView.editForm2}"  >
								            	<f:param name="action" value="${el.id}" />
								            </p:commandButton>
								            
								         </p:panel>								                   						             						    					
								    </f:facet>
								 
							    
							    
								<p:ajax event="connect" listener="#{flowEditorView.onConnect}" update="form"  />
						        <p:ajax event="disconnect"  listener="#{flowEditorView.onDisconnect}" />
						        <p:ajax event="connectionChange" listener="#{flowEditorView.onConnectionChange}" />
								  
						    </p:diagram>
						    
						    
							
						    <p:droppable id="dragPalletoToEditor" 
						                 for="flowEditor" tolerance="touch" 
						                 activeStyleClass="ui-state-highlight" datasource="palleteData" onDrop="handleDrop"
						                 widgetVar="dropWV">
						        <p:ajax listener="#{flowEditorView.onDropFormType}" update="form" />						        
						    </p:droppable>						    						    
					</p:layoutUnit>
					<p:layoutUnit effectSpeed="50" minSize="25" maxSize="265" effect="slide" collapsed="true" collapseSize="25" id="left_config" position="east" size="265" header="Settings" resizable="true" closable="false" collapsible="true" style="text-align:center" >
						<p:messages id="messages" />
						
						
				 	</p:layoutUnit>
				</p:layout>
				 
			</h:form>
			<!-- script type="text/javascript">
			    //<![CDATA[
			    PrimeFaces.widget.Droppable.prototype.bindDropListener = function() {
			        var _self = this;

			        this.cfg.drop = function(event, ui) {
						
			            if (_self.cfg.onDrop) {
			                _self.cfg.onDrop.call(_self, event, ui);
			            }
			            if (_self.cfg.behaviors) {
			                var dropBehavior = _self.cfg.behaviors['drop'];
			                if (dropBehavior) {
			                    var ext = {
			                        params : [ {
			                            name : _self.id + '_dragId',
			                            value : ui.draggable.attr('id')
			                        }, {
			                            name : _self.id + '_dropId',
			                            value : _self.cfg.target
			                        }, {
			                            name : _self.cfg.target + '_left',
			                            value : ui.position.left
			                        }, {
			                            name : _self.cfg.target + '_top',
			                            value : ui.position.top
			                        } ]
			                    };
			                    console.log(ui);
			                    dropBehavior.call(_self, ext);
			                }
			            }
			        };
			    }
			    // ]]>
			</script-->   

		</ui:define>
	</ui:composition>
</html>
